# YOLOFoodCal 项目技术总结

## 一、项目概述

YOLOFoodCal 是一个轻量级 AI 食物识别与卡路里估算开源 Demo 项目，基于 YOLO26/YOLO11 最新的计算机视觉模型实现。

**项目定位**：展示 YOLO 如何落地到真实场景的 Demo，可运行、可讲解、可开源。

---

## 二、技术架构

### 2.1 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        输入层                                │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌──────────┐   │
│  │ 单张图片 │  │  摄像头  │  │  视频流  │  │  Web API │   │
│  └────┬────┘  └────┬────┘  └────┬────┘  └─────┬────┘   │
└───────┼────────────┼────────────┼──────────────┼──────────┘
        │            │            │              │
        ▼            ▼            ▼              ▼
┌─────────────────────────────────────────────────────────────┐
│                      预处理层                                │
│              图像 Resize / 归一化 / Data Augmentation     │
└─────────────────────────────┬───────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    模型推理层 (Core)                        │
│  ┌─────────────────────────────────────────────────────┐    │
│  │           YOLO26n-seg / YOLO11n                   │    │
│  │  Backbone    │    Neck     │   Head (Det+Seg)    │    │
│  │  C3k2/SPPF   │   PAFPN     │   Detect + Mask     │    │
│  └─────────────────────────────────────────────────────┘    │
│  输入: 640x640 → 输出: BBox + Class + Mask              │
└─────────────────────────────┬───────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      后处理层                               │
│     NMS过滤  │  Mask裁剪  │  类别映射  │  面积计算      │
└─────────────────────────────┬───────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                       估算层                                │
│  ┌─────────────────────┐    ┌─────────────────────────┐   │
│  │   Portion Estimator  │    │   Nutrition Database    │   │
│  │  Mask像素 → 克重     │    │   JSON (68种食物)      │   │
│  │  Area × Factor       │    │   Calories lookup      │   │
│  └──────────┬──────────┘    └───────────┬─────────────┘   │
│             │                           │                   │
│             └───────────┬───────────────┘                   │
│                         ▼                                   │
│              ┌─────────────────────┐                      │
│              │  FoodItem Output    │                      │
│              │  - name             │                      │
│              │  - calories         │                      │
│              │  - protein/carbs/fat│                      │
│              │  - portion (g/ml)   │                      │
│              └─────────────────────┘                      │
└─────────────────────────────┬───────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     可视化层                                │
│     Streamlit Web UI  │  CLI Demo  │  JSON Export       │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 模块划分

```
YOLOFoodCal/
├── src/
│   ├── detector.py          # YOLO 模型封装，支持 PT/ONNX
│   ├── estimator.py         # 热量估算主逻辑
│   ├── nutrition_db.py     # JSON 营养数据库
│   ├── portion_estimator.py # 份量估算 (Mask → grams)
│   ├── visualizer.py       # 结果可视化 (BBox + Mask + Label)
│   ├── postprocess.py      # NMS、Mask处理
│   └── utils.py           # 工具函数
├── apps/
│   ├── cli_demo.py         # 命令行 Demo
│   └── streamlit_app.py    # Web UI (默认)
├── models/
│   ├── yolo11n-food.pt    # 训练的食物模型 (42类)
│   └── onnx/              # ONNX 导出 (Web部署用)
├── data/
│   └── nutrition_table_extended.json  # 68种食物营养数据
└── scripts/
    ├── export_onnx.py     # ONNX 导出脚本
    └── train_food_model.py # 自定义训练脚本
```

---

## 三、技术深度

### 3.1 模型选择

| 模型 | 参数 | mAP@50 | FLOPs | 特点 |
|------|------|--------|-------|------|
| **YOLO26n-seg** | 3.0M | 39.6% | 10.3G | 2026最新，NMS-free，CPU快43% |
| **YOLO11n** | 2.6M | ~37% | 6.5G | 轻量级，适合边缘部署 |
| YOLO8n-seg | 3.2M | 37.3% | 8.7G | 成熟稳定 |

**技术选型理由**：
- YOLO26 是 Ultralytics 2026年1月发布的最新模型
- 采用 NMS-free 架构，简化后处理
- CPU 推理比 YOLO11 快 43%
- 支持实例分割 (Segmentation) 用于面积估算

### 3.2 份量估算算法

```python
# 基于 Mask 面积的估算公式
份量(g) = Mask像素面积 × px_to_gram_factor

# px_to_gram_factor 根据食物类别不同：
# - 米饭: 0.012 (较密实)
# - 沙拉: 0.008 (较松散)
# - 冰淇淋: 0.006 (体积大)
```

### 3.3 热量计算

```python
# 基础公式
总热量 = (份量_g / 100) × 每100g热量

# 置信度计算
estimation_confidence = detection_confidence × portion_confidence
```

### 3.4 技术栈

| 层级 | 技术 | 版本 |
|------|------|------|
| 模型框架 | Ultralytics | 8.4+ |
| 推理后端 | PyTorch / ONNX Runtime | 2.0+ / 1.16+ |
| Web 框架 | Streamlit | 1.30+ |
| 图像处理 | OpenCV + Pillow | 4.9+ |
| 数据格式 | JSON (无数据库依赖) | - |

---

## 四、项目优势

### 4.1 工程优势

| 优势 | 说明 |
|------|------|
| **轻量级** | 模型仅 6-15MB，单机可运行 |
| **无数据库** | 静态 JSON 营养表，免部署复杂后端 |
| **开箱即用** | 预训练模型 + 示例数据 |
| **易于扩展** | 添加食物只需修改 JSON |

### 4.2 教育优势

- 完整展示 YOLO 从训练到部署的全流程
- 模块化设计，易于理解和修改
- 支持 ONNX 导出，展示模型优化思路
- 可作为计算机视觉教学 Demo

### 4.3 部署优势

```
✅ 单机运行 (Python)
✅ Web 服务 (Streamlit)
✅ ONNX 浏览器端推理 (Web)
✅ 移动端部署 (TensorFlow Lite)
✅ 边缘设备 (TensorRT)
```

---

## 五、业务应用场景

### 5.1 当前适用场景

| 场景 | 精度 | 说明 |
|------|------|------|
| 饮食记录 App | ★★★☆☆ | 个人饮食追踪，非医疗级 |
| 短视频内容展示 | ★★★★☆ | 演示 YOLO 落地效果 |
| 餐饮管理 | ★★☆☆☆ | 估算参考，需校准 |
| 教学演示 | ★★★★★ | 完整的 CV Demo 项目 |

### 5.2 可扩展方向

```
短期扩展：
├── 增加更多食物类别
├── 添加份量参考物 (硬币/手掌)
└── 支持多角度估算

长期扩展：
├── 接入 USDA API 获取更精确营养数据
├── 使用深度学习回归模型估算体积
├── 3D 重建 (需要额外传感器)
└── 个性化营养建议
```

### 5.3 不适用的场景

| 场景 | 原因 |
|------|------|
| 医疗诊断 | 精度不足，无专业认证 |
| 精确营养计算 | 依赖估算，无标准参考物 |
| 商业营养标签 | 需要合规认证 |

---

## 六、与同类项目对比

| 项目 | 模型 | 食物类别 | 热量估算 | 依赖 | 部署复杂度 |
|------|------|----------|----------|------|------------|
| **YOLOFoodCal** | YOLO26 | 42 (+68营养) | JSON本地 | 无 | ⭐ 简单 |
| Foodvisor | YOLO | 500+ | API | 数据库 | 复杂 |
| CalorieMATE | YOLOv5 | 100+ | 云服务 | 云API | 中等 |
| 论文方案 | YOLOv8 | 自定义 | ML回归 | GPU | 复杂 |

---

## 七、总结

YOLOFoodCal 是一个**工程化**的计算机视觉 Demo 项目：

- **技术深度**：涵盖 YOLO 最新模型、实例分割、热量估算、工程部署
- **架构清晰**：模块化设计，依赖简洁，易于扩展
- **落地性强**：单机运行、无数据库、Web+CLI 双接口
- **教学价值**：完整的模型训练→推理→部署流程

**项目定位**：作为 YOLO 落地的技术展示 Demo，而非商业级产品。

---

*Generated: 2026-02-15*
